use "../../src/core/crypto.zx" as crypto

// Test quantum-resistant cryptography - EXECUTABLE VERSION
print("ğŸ§ª Starting Quantum Crypto Test...")

action async test_quantum_crypto() -> boolean {
    print("ğŸ” Testing Quantum Cryptography...")
    
    let qcrypto = crypto.get_quantum_crypto()
    
    // Test key generation
    print("1. Testing key generation...")
    let keypair = qcrypto.generate_quantum_keypair()
    if (keypair.public_key == "") {
        print("âŒ Key generation failed")
        return false
    }
    print("âœ… Quantum keypair generated")
    print("   Address: " + keypair.address)
    
    // Test signing
    print("2. Testing quantum signing...")
    let message = "Test message for quantum signing"
    let signature = qcrypto.quantum_sign(message, keypair.private_key)
    if (signature == "") {
        print("âŒ Quantum signing failed")
        return false
    }
    print("âœ… Quantum signing working")
    print("   Signature length: " + string(signature.length()))
    
    // Test verification
    print("3. Testing quantum verification...")
    let verified = qcrypto.quantum_verify(message, signature, keypair.public_key)
    if (not verified) {
        print("âŒ Quantum verification failed")
        return false
    }
    print("âœ… Quantum verification working")
    
    // Test address derivation
    print("4. Testing address derivation...")
    let address = qcrypto.derive_address(keypair.public_key, "ZIVER")
    if (not address.starts_with("ZIV_")) {
        print("âŒ Address derivation failed")
        return false
    }
    print("âœ… Address derivation working")
    print("   Derived address: " + address)
    
    return true
}

// Actually run the test
print("")
print("ğŸš€ EXECUTING QUANTUM CRYPTO TEST")
print("================================")

let result = await test_quantum_crypto()

print("")
if (result) {
    print("ğŸ‰ QUANTUM CRYPTO TEST PASSED!")
    print("âœ… All quantum-resistant features working")
} else {
    print("âŒ QUANTUM CRYPTO TEST FAILED")
    print("âš ï¸  Check crypto implementation")
}

print("")